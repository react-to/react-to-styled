import { Meta, Canvas, Story } from '@storybook/addon-docs'
import styled from 'styled-components'
import { Table, TruncatedText } from '@react-to-styled/table'
import { Colors } from '@react-to-styled/essentials'
import { useState } from 'react'

<Meta
  title="Table/All table stories"
  component={Table}
  parameters={{ controls: { exclude: /.*/s } }}
/>

export const Wrapper = styled.div`
  padding: 2rem;
`

export const MobileWrapper = styled.div`
  max-width: 360px;
  margin: auto;
`

export const WrappedText = styled.div`
  word-break: break-all;
`

export const ExpandedRow = styled.div`
  background: ${Colors.chartTitleBackground};
  display: flex;
  flex-direction: column;
  padding: 1rem 1.4rem;
  border-bottom: 1px solid ${Colors.borderColor};
`

export const defaultColumns = {
  title: {
    header: 'Title',
    Cell: ({ data: { title } }) => <span>{title}</span>,
  },
  price: {
    header: 'Price',
    Cell: ({ data: { price } }) => <span>{price}</span>,
  },
}

export const defaultData = [
  { title: 'One', price: 100 },
  { title: 'Two', price: 200 },
]

# Table stories

---

Here you can see examples of some possible scenarios.

## Long data example

<Canvas>
  <Story
    name="Long data example"
    parameters={{
      viewport: { defaultViewport: 'mobile2' },
    }}
  >
    {() => {
      const columns = {
        title: {
          header: 'Title',
          Cell: ({ data: { title } }) => <WrappedText>{title}</WrappedText>,
        },
        price: {
          header: 'Price',
          Cell: ({ data: { price } }) => <span>{price}</span>,
          width: 100,
        },
      }
      const data = [
        { title: 'One long text to be seen on mobile', price: 100 },
        { title: 'Onealsoverylongtextjustwithoutthespace', price: 200 },
      ]
      return (
        <MobileWrapper>
          <Table expandable columns={columns} data={data} />
        </MobileWrapper>
      )
    }}
  </Story>
</Canvas>

## Truncated table

<Canvas>
  <Story
    name="Truncated table"
    parameters={{
      viewport: { defaultViewport: 'mobile2' },
    }}
  >
    {() => {
      const columns = {
        title: {
          header: 'Title',
          Cell: ({ data: { title } }) => <TruncatedText>{title}</TruncatedText>,
        },
        price: {
          header: 'Price',
          Cell: ({ data: { price } }) => <span>{price}</span>,
          width: 100,
        },
      }
      const data = [
        { title: 'One long text to be seen on mobile', price: 100 },
        { title: 'Onealsoverylongtextjustwithoutthespace', price: 200 },
      ]
      return (
        <MobileWrapper>
          <Table expandable columns={columns} data={data} />
        </MobileWrapper>
      )
    }}
  </Story>
</Canvas>

## Expandable table

<Canvas>
  <Story name="Expanded Row">
    {() => {
      const columns = {
        ...defaultColumns,
        action: {
          header: 'Action',
          Cell: ({ onRowExpand }) => {
            const [isExpanded, setIsExpanded] = useState(false)
            const onExpand = () => {
              setIsExpanded(!isExpanded)
              onRowExpand(!isExpanded)
            }
            return (
              <button onClick={() => onExpand()}>
                {isExpanded ? 'Close' : 'Expand'}
              </button>
            )
          },
          ExpandedCell: ({ data: { title, price } }) => {
            return (
              <ExpandedRow>
                Expanded row ({title} {price})
              </ExpandedRow>
            )
          },
          width: 100,
        },
      }
      return (
        <Wrapper>
          <Table expandable columns={columns} data={defaultData} />
        </Wrapper>
      )
    }}
  </Story>
</Canvas>

## Lazy table

<Canvas>
  <Story name="Lazy table">
    {() => {
      /**
       * Mocked data
       */
      const mockedData = Array(100)
        .fill(true)
        .map((_, index) => ({
          title: `Row ${index + 1}`,
          price: (Math.random() * 100).toFixed(2),
        }))
      /**
       * Page limit
       */
      const PAGE_LIMIT = 10
      /**
       * Initial slice of mocked data
       */
      const [data, setData] = useState(mockedData.slice(0, PAGE_LIMIT))
      /**
       * Initial slice of mocked data
       */
      const [isLoading, setIsLoading] = useState(false)
      /**
       * Current page
       */
      const [currentPage, setCurrentPage] = useState(1)
      /**
       * Pagination
       */
      const onPagination = p => {
        setIsLoading(true)
        setData(mockedData.slice(p * PAGE_LIMIT - PAGE_LIMIT, p * PAGE_LIMIT))
        setCurrentPage(p)
        setTimeout(() => setIsLoading(false), 1000)
      }
      return (
        <Wrapper>
          <Table
            columns={defaultColumns}
            paginationProps={{
              currentPage,
              onPagination,
              pageLimit: PAGE_LIMIT,
              totalRecords: mockedData.length,
            }}
            isLoading={isLoading}
            data={data}
          />
        </Wrapper>
      )
    }}
  </Story>
</Canvas>
